# ブログ記事表示アプリ 仕様書

## 1. システム概要

Markdown形式で書かれたファイルをブログ記事として表示するNext.jsベースのWebアプリケーションです。

### 1.1 目的

- Markdownファイルからブログ記事を動的に生成し、ユーザーフレンドリーな形式で表示する
- シンプルで保守性の高いコンテンツ管理システムを提供する
- 静的サイト生成（SSG）により高速なページ表示を実現する

### 1.2 想定ユーザー

- ブログ管理者：Markdownファイルを作成・編集してコンテンツを管理
- ブログ閲覧者：Webブラウザを通じてブログ記事を閲覧

## 2. 機能要件

### 2.1 必須機能

#### 2.1.1 記事一覧表示
- すべてのブログ記事の一覧を表示
- 記事のタイトル、公開日、概要を表示
- 最新の記事から順に表示（降順ソート）
- ページネーション機能（記事数が多い場合）

#### 2.1.2 記事詳細表示
- Markdownファイルの内容をHTMLに変換して表示
- 記事のメタデータ（タイトル、公開日、著者、タグなど）を表示
- 目次（TOC）の自動生成
- コードブロックのシンタックスハイライト

#### 2.1.3 記事検索機能
- タイトルと本文による全文検索
- タグによる絞り込み
- 日付範囲による絞り込み

#### 2.1.4 レスポンシブデザイン
- デスクトップ、タブレット、モバイルデバイスに対応
- ダークモード対応

### 2.2 任意機能（将来的な拡張）

- コメント機能
- SNSシェアボタン
- 関連記事の表示
- RSS/Atomフィード
- 記事のお気に入り/ブックマーク機能
- 記事のビュー数カウント

## 3. 技術仕様

### 3.1 フロントエンド

- **フレームワーク**: Next.js 16.x（App Router使用）
- **言語**: TypeScript
- **UI**: React 19.x
- **スタイリング**: Tailwind CSS 4
- **Markdownパーサー**: 
  - `gray-matter`: フロントマター解析
  - `remark`: Markdown → HTML変換
  - `remark-html`: HTML出力
  - `remark-prism` or `rehype-prism-plus`: シンタックスハイライト

### 3.2 データ管理

- **記事の保存場所**: プロジェクトルート直下の`posts/`ディレクトリ
- **ファイル形式**: Markdown (`.md`)
- **メタデータ形式**: YAML Front Matter

### 3.3 レンダリング戦略

- **記事一覧ページ**: Static Site Generation (SSG)
- **記事詳細ページ**: Static Site Generation (SSG) + ISR (Incremental Static Regeneration)
- **検索機能**: Client-side filtering（将来的にはサーバーサイド実装を検討）

## 4. ファイル・ディレクトリ構造

```
blog-next-js-app/
├── posts/                      # Markdownファイル格納ディレクトリ
│   ├── 2024-01-15-first-post.md
│   ├── 2024-02-20-second-post.md
│   └── ...
├── src/
│   └── app/
│       ├── blog/
│       │   ├── page.tsx        # 記事一覧ページ
│       │   └── [slug]/
│       │       └── page.tsx    # 記事詳細ページ
│       ├── components/
│       │   ├── BlogCard.tsx    # 記事カードコンポーネント
│       │   ├── BlogList.tsx    # 記事一覧コンポーネント
│       │   ├── MarkdownContent.tsx  # Markdown表示コンポーネント
│       │   ├── TableOfContents.tsx  # 目次コンポーネント
│       │   └── SearchBar.tsx   # 検索バーコンポーネント
│       └── ...
├── lib/
│   ├── posts.ts                # 記事取得・解析ユーティリティ
│   └── markdown.ts             # Markdown変換ユーティリティ
├── types/
│   └── post.ts                 # 記事型定義
└── ...
```

## 5. データモデル

### 5.1 Markdownファイルのフロントマター

各Markdownファイルは以下のYAML Front Matterを含む：

```yaml
---
title: "記事のタイトル"
date: "2024-01-15"
author: "著者名"
tags: ["Next.js", "TypeScript", "ブログ"]
description: "記事の概要説明（150文字程度）"
image: "/images/posts/thumbnail.jpg"  # オプション
published: true  # 下書き管理用
---

# 記事本文

ここに記事の内容を書く...
```

### 5.2 Post型定義

```typescript
interface Post {
  slug: string;              // ファイル名から生成されるURL用ID
  title: string;             // 記事タイトル
  date: string;              // 公開日（ISO 8601形式）
  author: string;            // 著者名
  tags: string[];            // タグの配列
  description: string;       // 記事の概要
  image?: string;            // サムネイル画像のパス（オプション）
  published: boolean;        // 公開/非公開フラグ
  content: string;           // Markdown本文（または変換後のHTML）
}
```

## 6. API設計

### 6.1 ユーティリティ関数

#### `getAllPosts(): Promise<Post[]>`
- すべての公開済み記事を取得
- 日付の降順でソート
- 戻り値: Post配列

#### `getPostBySlug(slug: string): Promise<Post | null>`
- 指定されたslugの記事を取得
- Markdownファイルを読み込み、フロントマターを解析
- 戻り値: Post オブジェクトまたはnull

#### `getPostSlugs(): Promise<string[]>`
- すべての記事のslugを取得
- 静的パス生成に使用
- 戻り値: slug文字列の配列

#### `markdownToHtml(markdown: string): Promise<string>`
- MarkdownをHTMLに変換
- シンタックスハイライトを適用
- 戻り値: HTML文字列

#### `searchPosts(query: string, tags?: string[]): Promise<Post[]>`
- 記事を検索
- クエリ文字列とタグで絞り込み
- 戻り値: マッチしたPost配列

## 7. UI/UX設計

### 7.1 ページレイアウト

#### 記事一覧ページ (`/blog`)
```
┌─────────────────────────────────────┐
│           ヘッダー                    │
├─────────────────────────────────────┤
│        検索バー・フィルター            │
├─────────────────────────────────────┤
│  ┌───────────────────────────────┐  │
│  │ 記事カード1                     │  │
│  │ - タイトル                      │  │
│  │ - 日付 | 著者                   │  │
│  │ - 概要                         │  │
│  │ - タグ                         │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 記事カード2                     │  │
│  └───────────────────────────────┘  │
│  ...                                │
├─────────────────────────────────────┤
│        ページネーション                │
├─────────────────────────────────────┤
│           フッター                    │
└─────────────────────────────────────┘
```

#### 記事詳細ページ (`/blog/[slug]`)
```
┌─────────────────────────────────────┐
│           ヘッダー                    │
├─────────────────────────────────────┤
│     記事タイトル                      │
│     日付 | 著者 | タグ                │
├──────────┬──────────────────────────┤
│  目次     │   記事本文                 │
│  (TOC)   │   - 見出し                 │
│          │   - 段落                   │
│          │   - コードブロック          │
│          │   - 画像                   │
│          │   ...                     │
├──────────┴──────────────────────────┤
│      関連記事 / 前後の記事             │
├─────────────────────────────────────┤
│           フッター                    │
└─────────────────────────────────────┘
```

### 7.2 デザインガイドライン

- **カラースキーム**:
  - ライトモード: 白基調、アクセントカラー（ブルー系）
  - ダークモード: ダークグレー基調、アクセントカラー（シアン系）
- **タイポグラフィ**:
  - 見出し: ゴシック系フォント（太字）
  - 本文: 明朝系またはゴシック系フォント（読みやすさ重視）
  - コード: モノスペースフォント
- **レスポンシブブレークポイント**:
  - モバイル: ~640px
  - タブレット: 641px~1024px
  - デスクトップ: 1025px~

## 8. セキュリティ考慮事項

- XSS対策: Markdownをサニタイズ（DOMPurifyまたはremarkのセキュアな設定）
- パス・トラバーサル対策: ファイルパスの検証
- 入力検証: 検索クエリのサニタイズ

## 9. パフォーマンス最適化

- 画像の最適化（Next.js Imageコンポーネント使用）
- 遅延読み込み（Lazy Loading）
- コード分割
- キャッシング戦略（ISRの活用）
- 軽量なMarkdownパーサーの選択

## 10. アクセシビリティ

- セマンティックHTML使用
- 適切なARIA属性の付与
- キーボードナビゲーション対応
- スクリーンリーダー対応
- 十分なコントラスト比の確保

## 11. テスト戦略

- **ユニットテスト**: ユーティリティ関数のテスト
- **統合テスト**: コンポーネントのレンダリングテスト
- **E2Eテスト**: 主要なユーザーフローのテスト（オプション）
- **アクセシビリティテスト**: axe-coreなどのツール使用

## 12. デプロイメント

- **推奨プラットフォーム**: Vercel（Next.jsとの統合が優れている）
- **代替プラットフォーム**: Netlify, AWS Amplify, Cloudflare Pages
- **ビルドコマンド**: `npm run build`
- **出力ディレクトリ**: `.next/`

## 13. 今後の拡張性

- マルチ言語対応（i18n）
- 記事のカテゴリー機能
- 著者プロフィールページ
- アーカイブページ（年月別）
- サイトマップ自動生成
- OGP画像の自動生成
